<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/AndroidManifest.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/AndroidManifest.xml" />
              <option name="originalContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    xmlns:tools=&quot;http://schemas.android.com/tools&quot;&gt;&#10;&#10;    &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;&#10;    &lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot; /&gt;&#10;&#10;    &lt;application&#10;        android:allowBackup=&quot;true&quot;&#10;        android:dataExtractionRules=&quot;@xml/data_extraction_rules&quot;&#10;        android:fullBackupContent=&quot;@xml/backup_rules&quot;&#10;        android:icon=&quot;@mipmap/ic_launcher&quot;&#10;        android:label=&quot;@string/app_name&quot;&#10;        android:roundIcon=&quot;@mipmap/ic_launcher_round&quot;&#10;        android:supportsRtl=&quot;true&quot;&#10;        android:theme=&quot;@style/Theme.MedTracker&quot;&#10;        tools:targetApi=&quot;31&quot;&gt;&#10;        &lt;activity&#10;            android:name=&quot;.ui.LoginActivity&quot;&#10;            android:exported=&quot;true&quot;&#10;            android:label=&quot;Login&quot;&gt;&#10;            &lt;intent-filter&gt;&#10;                &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;&#10;                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;&#10;            &lt;/intent-filter&gt;&#10;        &lt;/activity&gt;&#10;        &lt;activity&#10;            android:name=&quot;.ui.MainActivity&quot;&#10;            android:exported=&quot;true&quot;&#10;            android:label=&quot;@string/app_name&quot;&#10;            android:theme=&quot;@style/Theme.MedTracker&quot; /&gt;&#10;        &lt;activity&#10;            android:name=&quot;.dev.OpenFdaSandboxActivity&quot;&#10;            android:exported=&quot;true&quot;&#10;            android:label=&quot;OpenFDA Sandbox (debug)&quot; /&gt;&#10;        &lt;activity&#10;            android:name=&quot;.ui.LogsActivity&quot;&#10;            android:exported=&quot;false&quot;&#10;            android:label=&quot;Logs&quot; /&gt;&#10;        &lt;activity&#10;            android:name=&quot;.ui.StatsActivity&quot;&#10;            android:exported=&quot;false&quot;&#10;            android:label=&quot;Stats&quot; /&gt;&#10;        &lt;activity&#10;            android:name=&quot;.ui.SearchActivity&quot;&#10;            android:exported=&quot;true&quot;&#10;            android:label=&quot;Search&quot; /&gt;&#10;    &lt;/application&gt;&#10;&#10;&lt;/manifest&gt;" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    xmlns:tools=&quot;http://schemas.android.com/tools&quot;&gt;&#10;&#10;    &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;&#10;    &lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot; /&gt;&#10;&#10;    &lt;application&#10;        android:allowBackup=&quot;true&quot;&#10;        android:dataExtractionRules=&quot;@xml/data_extraction_rules&quot;&#10;        android:fullBackupContent=&quot;@xml/backup_rules&quot;&#10;        android:icon=&quot;@mipmap/ic_launcher&quot;&#10;        android:label=&quot;@string/app_name&quot;&#10;        android:roundIcon=&quot;@mipmap/ic_launcher_round&quot;&#10;        android:supportsRtl=&quot;true&quot;&#10;        android:theme=&quot;@style/Theme.MedTracker&quot;&#10;        tools:targetApi=&quot;31&quot;&gt;&#10;        &lt;activity&#10;            android:name=&quot;.ui.LoginActivity&quot;&#10;            android:exported=&quot;true&quot;&#10;            android:label=&quot;Login&quot;&gt;&#10;            &lt;intent-filter&gt;&#10;                &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;&#10;                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;&#10;            &lt;/intent-filter&gt;&#10;        &lt;/activity&gt;&#10;        &lt;activity&#10;            android:name=&quot;.ui.MainActivity&quot;&#10;            android:exported=&quot;true&quot;&#10;            android:label=&quot;@string/app_name&quot;&#10;            android:theme=&quot;@style/Theme.MedTracker&quot; /&gt;&#10;        &lt;activity&#10;            android:name=&quot;.dev.OpenFdaSandboxActivity&quot;&#10;            android:exported=&quot;true&quot;&#10;            android:label=&quot;OpenFDA Sandbox (debug)&quot; /&gt;&#10;        &lt;activity&#10;            android:name=&quot;.ui.LogsActivity&quot;&#10;            android:exported=&quot;false&quot;&#10;            android:label=&quot;Logs&quot; /&gt;&#10;        &lt;activity&#10;            android:name=&quot;.ui.StatsActivity&quot;&#10;            android:exported=&quot;false&quot;&#10;            android:label=&quot;Stats&quot; /&gt;&#10;        &lt;activity&#10;            android:name=&quot;.ui.SearchActivity&quot;&#10;            android:exported=&quot;true&quot;&#10;            android:label=&quot;Search&quot; /&gt;&#10;    &lt;/application&gt;&#10;&#10;&lt;/manifest&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/medtracker/data/db/AppDatabase.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/medtracker/data/db/AppDatabase.kt" />
              <option name="originalContent" value="package com.example.medtracker.data.db&#10;&#10;import androidx.room.*&#10;import com.example.medtracker.data.db.dao.DoseLogDao&#10;import com.example.medtracker.data.db.dao.DoseScheduleDao&#10;import com.example.medtracker.data.db.dao.DoseTimeDao&#10;import com.example.medtracker.data.db.dao.DrugDao&#10;import com.example.medtracker.data.db.dao.UserProfileDao&#10;import com.example.medtracker.data.db.entities.*&#10;&#10;@Database(&#10;    entities = [&#10;        UserProfile::class,&#10;        Drug::class,&#10;        DoseSchedule::class,&#10;        DoseTime::class,&#10;        DoseLog::class&#10;    ],&#10;    version = 1,&#10;    exportSchema = true&#10;)&#10;@TypeConverters(Converters::class)&#10;abstract class AppDatabase : RoomDatabase() {&#10;&#10;    abstract fun userProfileDao(): UserProfileDao&#10;    abstract fun drugDao(): DrugDao&#10;    abstract fun doseScheduleDao(): DoseScheduleDao&#10;    abstract fun doseTimeDao(): DoseTimeDao&#10;    abstract fun doseLogDao(): DoseLogDao&#10;}" />
              <option name="updatedContent" value="package com.example.medtracker.data.db&#10;&#10;import androidx.room.*&#10;import com.example.medtracker.data.db.dao.DoseLogDao&#10;import com.example.medtracker.data.db.dao.DoseScheduleDao&#10;import com.example.medtracker.data.db.dao.DoseTimeDao&#10;import com.example.medtracker.data.db.dao.DrugDao&#10;import com.example.medtracker.data.db.dao.UserProfileDao&#10;import com.example.medtracker.data.db.entities.*&#10;&#10;@Database(&#10;    entities = [&#10;        UserProfile::class,&#10;        Drug::class,&#10;        DoseSchedule::class,&#10;        DoseTime::class,&#10;        DoseLog::class&#10;    ],&#10;    version = 1,&#10;    exportSchema = true&#10;)&#10;@TypeConverters(Converters::class)&#10;abstract class AppDatabase : RoomDatabase() {&#10;&#10;    abstract fun userProfileDao(): UserProfileDao&#10;    abstract fun drugDao(): DrugDao&#10;    abstract fun doseScheduleDao(): DoseScheduleDao&#10;    abstract fun doseTimeDao(): DoseTimeDao&#10;    abstract fun doseLogDao(): DoseLogDao&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/medtracker/data/db/DbSmokeTest.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/medtracker/data/db/DbSmokeTest.kt" />
              <option name="originalContent" value="package com.example.medtracker.data.db&#10;&#10;import android.content.Context&#10;import androidx.test.core.app.ApplicationProvider&#10;import androidx.test.ext.junit.runners.AndroidJUnit4&#10;import org.junit.After&#10;import org.junit.Assert.*&#10;import org.junit.Before&#10;import org.junit.Test&#10;import org.junit.runner.RunWith&#10;import androidx.room.Room&#10;import com.example.medtracker.data.db.entities.DoseLog&#10;import com.example.medtracker.data.db.entities.DoseSchedule&#10;import com.example.medtracker.data.db.entities.DoseTime&#10;import com.example.medtracker.data.db.entities.Drug&#10;import com.example.medtracker.data.db.entities.UserProfile&#10;import kotlinx.coroutines.runBlocking&#10;&#10;@RunWith(AndroidJUnit4::class)&#10;class DbSmokeTest {&#10;    private lateinit var context: Context&#10;    private lateinit var db: AppDatabase&#10;&#10;    @Before&#10;    fun setup() {&#10;        context = ApplicationProvider.getApplicationContext&lt;Context&gt;()&#10;        db = Room.inMemoryDatabaseBuilder(context, AppDatabase::class.java)&#10;            .allowMainThreadQueries()&#10;            .build()&#10;    }&#10;&#10;    @After&#10;    fun tearDown() {&#10;        db.drugDao()&#10;    }&#10;&#10;    @Test&#10;    fun fullFlow_smoke() = runBlocking {&#10;        val userDao = db.userProfileDao()&#10;        val drugDao = db.drugDao()&#10;        val schedDao = db.doseScheduleDao()&#10;        val timeDao = db.doseTimeDao()&#10;        val logDao = db.doseLogDao()&#10;&#10;        val now = System.currentTimeMillis()&#10;&#10;        //upsert a user&#10;        userDao.upsert(UserProfile(uid = &quot;local&quot;, firstName = &quot;John&quot;))&#10;&#10;        //insert a drug&#10;        val drugId = drugDao.insert(&#10;            Drug(&#10;                uid = &quot;local&quot;,&#10;                name = &quot;Apixaban&quot;,&#10;                brandName = &quot;Eliquis&quot;,&#10;                drugbankId = &quot;DB06605&quot;,&#10;                strength = 5.0,&#10;                unit = &quot;mg&quot;,&#10;                form = &quot;tablet&quot;,&#10;                notes = null,&#10;                createdAt = now,&#10;                updatedAt = now&#10;            )&#10;        )&#10;        assertTrue(drugId &gt; 0)&#10;&#10;        //insert SAME drug&#10;        try {&#10;            drugDao.insert(&#10;                Drug(&#10;                    uid = &quot;local&quot;,&#10;                    name = &quot;Apixaban&quot;,&#10;                    brandName = &quot;Eliquis&quot;,&#10;                    drugbankId = &quot;DB06605&quot;,&#10;                    strength = 5.0,&#10;                    unit = &quot;mg&quot;,&#10;                    form = &quot;tablet&quot;,&#10;                    notes = null,&#10;                    createdAt = now,&#10;                    updatedAt = now&#10;                )&#10;            )&#10;            fail(&quot;Expected failure for duplicate Drug&quot;)&#10;        } catch (e: Exception) {&#10;            println(&quot;Expected failure for duplicate Drug: ${'$'}{e.message}&quot;)&#10;        }&#10;&#10;        //save a sched for the drug&#10;        val schedId = schedDao.saveOrReplaceForDrug(&#10;            schedule = DoseSchedule(&#10;                drugId = drugId,&#10;                prn = false,&#10;                freqType = &quot;WEEKLY&quot;,&#10;                byWeekDay = listOf(&quot;MO&quot;, &quot;WE&quot;),&#10;                intervalHours = null,&#10;                everyNDays = null,&#10;                endDate = null,&#10;                timeZone = &quot;America/New_York&quot;,&#10;                doseUnit = &quot;tablet&quot;,&#10;                createdAt = now,&#10;                updatedAt = now&#10;            ),&#10;            times = listOf(11 * 60 to 1.0, 23 * 60 to 2.0)&#10;        )&#10;        assertTrue(schedId &gt; 0)&#10;&#10;        //read back aggregated schedule+times&#10;        val agg = schedDao.getWithTimesByDrugId(drugId)&#10;        assertNotNull(agg)&#10;        assertEquals(2, agg!!.times.size)&#10;        assertEquals(&quot;WEEKLY&quot;, agg.schedule.freqType)&#10;&#10;        try {&#10;            schedDao.insert(&#10;                DoseSchedule(&#10;                    drugId = drugId,&#10;                    prn = false,&#10;                    freqType = &quot;DAILY&quot;,&#10;                    byWeekDay = null,&#10;                    intervalHours = null,&#10;                    everyNDays = null,&#10;                    startDate = null,&#10;                    endDate = null,&#10;                    timeZone = &quot;America/New_York&quot;,&#10;                    doseUnit = &quot;tablet&quot;,&#10;                    createdAt = now,&#10;                    updatedAt = now&#10;                )&#10;            )&#10;            fail(&quot;Expected unique for second schedule on same drug&quot;)&#10;        } catch (e: Exception) {&#10;            println(&quot;Expected unique constraint for second schedule: ${'$'}{e.message}&quot;)&#10;        }&#10;        try {&#10;            timeDao.insert(&#10;                DoseTime(&#10;                    doseScheduleId = schedId,&#10;                    minutesLocal = 11 * 60,&#10;                    doseCount = 1.0&#10;                )&#10;            )&#10;            fail(&quot;Expected unique constraint failure for duplicate DoseTime&quot;)&#10;        } catch (e: Exception) {&#10;            println(&quot;Expected duplicate DoseTime failure: ${'$'}{e.message}&quot;)&#10;        }&#10;&#10;        val plannedAt = now + 60_000&#10;        val logId = logDao.insert(&#10;            DoseLog(&#10;                drugId = drugId,&#10;                doseScheduleId = schedId,&#10;                plannedTime = plannedAt,&#10;                takenTime = null,&#10;                status = &quot;PLANNED&quot;,&#10;                quantity = null,&#10;                unit = null,&#10;                note = null&#10;            )&#10;        )&#10;        assertTrue(logId &gt; 0)&#10;&#10;        val takenAt = plannedAt + 120_000&#10;        logDao.markTaken(logId, status = &quot;TAKEN&quot;, takenAt = takenAt, quantity = 1.0, unit = &quot;tablet&quot;)&#10;&#10;        val fetched = logDao.getById(logId)&#10;        assertNotNull(fetched)&#10;        assertEquals(&quot;TAKEN&quot;, fetched!!.status)&#10;        assertEquals(takenAt, fetched.takenTime)&#10;        assertEquals(1.0, fetched.quantity!!, 1e-4)&#10;        assertEquals(&quot;tablet&quot;, fetched.unit)&#10;    }&#10;&#10;    @Test&#10;    fun prnSchedule_doesNotCreateTimes() = runBlocking {&#10;        val drugDao = db.drugDao()&#10;        val schedDao = db.doseScheduleDao()&#10;&#10;        val now = System.currentTimeMillis()&#10;&#10;        val drugId = drugDao.insert(&#10;            Drug(uid = &quot;local2&quot;, name = &quot;PRNTest&quot;, brandName = &quot;PRN&quot;, drugbankId = &quot;&quot;, strength = 0.0, unit = &quot;mg&quot;, form = &quot;tablet&quot;, notes = null, createdAt = now, updatedAt = now)&#10;        )&#10;&#10;        // Save a PRN schedule but provide times - sanitizer should remove times&#10;        val schedule = DoseSchedule(&#10;            drugId = drugId,&#10;            prn = true,&#10;            freqType = &quot;PRN&quot;,&#10;            byWeekDay = null,&#10;            intervalHours = null,&#10;            everyNDays = null,&#10;            timesOfDay = listOf(&quot;08:00&quot;, &quot;20:00&quot;),&#10;            timeZone = &quot;UTC&quot;,&#10;            createdAt = now,&#10;            updatedAt = now&#10;        )&#10;&#10;        val timesPairs = listOf(8 * 60 to 1.0, 20 * 60 to 1.0)&#10;        val schedId = schedDao.saveOrReplaceForDrug(schedule, timesPairs)&#10;        assertTrue(schedId &gt; 0)&#10;&#10;        val agg = schedDao.getWithTimesByDrugId(drugId)&#10;        assertNotNull(agg)&#10;        // For PRN schedule the times list should be empty&#10;        assertEquals(0, agg!!.times.size)&#10;        assertTrue(agg.schedule.prn)&#10;    }&#10;&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.medtracker.data.db&#10;&#10;import android.content.Context&#10;import androidx.test.core.app.ApplicationProvider&#10;import androidx.test.ext.junit.runners.AndroidJUnit4&#10;import org.junit.After&#10;import org.junit.Assert.*&#10;import org.junit.Before&#10;import org.junit.Test&#10;import org.junit.runner.RunWith&#10;import androidx.room.Room&#10;import com.example.medtracker.data.db.entities.DoseLog&#10;import com.example.medtracker.data.db.entities.DoseSchedule&#10;import com.example.medtracker.data.db.entities.DoseTime&#10;import com.example.medtracker.data.db.entities.Drug&#10;import com.example.medtracker.data.db.entities.UserProfile&#10;import kotlinx.coroutines.runBlocking&#10;&#10;@RunWith(AndroidJUnit4::class)&#10;class DbSmokeTest {&#10;    private lateinit var context: Context&#10;    private lateinit var db: AppDatabase&#10;&#10;    @Before&#10;    fun setup() {&#10;        context = ApplicationProvider.getApplicationContext&lt;Context&gt;()&#10;        db = Room.inMemoryDatabaseBuilder(context, AppDatabase::class.java)&#10;            .allowMainThreadQueries()&#10;            .build()&#10;    }&#10;&#10;    @After&#10;    fun tearDown() {&#10;        db.drugDao()&#10;    }&#10;&#10;    @Test&#10;    fun fullFlow_smoke() = runBlocking {&#10;        val userDao = db.userProfileDao()&#10;        val drugDao = db.drugDao()&#10;        val schedDao = db.doseScheduleDao()&#10;        val timeDao = db.doseTimeDao()&#10;        val logDao = db.doseLogDao()&#10;&#10;        val now = System.currentTimeMillis()&#10;&#10;        //upsert a user&#10;        userDao.upsert(UserProfile(uid = &quot;local&quot;, firstName = &quot;John&quot;))&#10;&#10;        //insert a drug&#10;        val drugId = drugDao.insert(&#10;            Drug(&#10;                uid = &quot;local&quot;,&#10;                name = &quot;Apixaban&quot;,&#10;                brandName = &quot;Eliquis&quot;,&#10;                drugbankId = &quot;DB06605&quot;,&#10;                strength = 5.0,&#10;                unit = &quot;mg&quot;,&#10;                form = &quot;tablet&quot;,&#10;                notes = null,&#10;                createdAt = now,&#10;                updatedAt = now&#10;            )&#10;        )&#10;        assertTrue(drugId &gt; 0)&#10;&#10;        //insert SAME drug&#10;        try {&#10;            drugDao.insert(&#10;                Drug(&#10;                    uid = &quot;local&quot;,&#10;                    name = &quot;Apixaban&quot;,&#10;                    brandName = &quot;Eliquis&quot;,&#10;                    drugbankId = &quot;DB06605&quot;,&#10;                    strength = 5.0,&#10;                    unit = &quot;mg&quot;,&#10;                    form = &quot;tablet&quot;,&#10;                    notes = null,&#10;                    createdAt = now,&#10;                    updatedAt = now&#10;                )&#10;            )&#10;            fail(&quot;Expected failure for duplicate Drug&quot;)&#10;        } catch (e: Exception) {&#10;            println(&quot;Expected failure for duplicate Drug: ${'$'}{e.message}&quot;)&#10;        }&#10;&#10;        //save a sched for the drug&#10;        val schedId = schedDao.saveOrReplaceForDrug(&#10;            schedule = DoseSchedule(&#10;                drugId = drugId,&#10;                prn = false,&#10;                freqType = &quot;WEEKLY&quot;,&#10;                byWeekDay = listOf(&quot;MO&quot;, &quot;WE&quot;),&#10;                intervalHours = null,&#10;                everyNDays = null,&#10;                endDate = null,&#10;                timeZone = &quot;America/New_York&quot;,&#10;                doseUnit = &quot;tablet&quot;,&#10;                createdAt = now,&#10;                updatedAt = now&#10;            ),&#10;            times = listOf(11 * 60 to 1.0, 23 * 60 to 2.0)&#10;        )&#10;        assertTrue(schedId &gt; 0)&#10;&#10;        //read back aggregated schedule+times&#10;        val agg = schedDao.getWithTimesByDrugId(drugId)&#10;        assertNotNull(agg)&#10;        assertEquals(2, agg!!.times.size)&#10;        assertEquals(&quot;WEEKLY&quot;, agg.schedule.freqType)&#10;&#10;        try {&#10;            schedDao.insert(&#10;                DoseSchedule(&#10;                    drugId = drugId,&#10;                    prn = false,&#10;                    freqType = &quot;DAILY&quot;,&#10;                    byWeekDay = null,&#10;                    intervalHours = null,&#10;                    everyNDays = null,&#10;                    startDate = null,&#10;                    endDate = null,&#10;                    timeZone = &quot;America/New_York&quot;,&#10;                    doseUnit = &quot;tablet&quot;,&#10;                    createdAt = now,&#10;                    updatedAt = now&#10;                )&#10;            )&#10;            fail(&quot;Expected unique for second schedule on same drug&quot;)&#10;        } catch (e: Exception) {&#10;            println(&quot;Expected unique constraint for second schedule: ${'$'}{e.message}&quot;)&#10;        }&#10;        try {&#10;            timeDao.insert(&#10;                DoseTime(&#10;                    doseScheduleId = schedId,&#10;                    minutesLocal = 11 * 60,&#10;                    doseCount = 1.0&#10;                )&#10;            )&#10;            fail(&quot;Expected unique constraint failure for duplicate DoseTime&quot;)&#10;        } catch (e: Exception) {&#10;            println(&quot;Expected duplicate DoseTime failure: ${'$'}{e.message}&quot;)&#10;        }&#10;&#10;        val plannedAt = now + 60_000&#10;        val logId = logDao.insert(&#10;            DoseLog(&#10;                drugId = drugId,&#10;                doseScheduleId = schedId,&#10;                plannedTime = plannedAt,&#10;                takenTime = null,&#10;                status = &quot;PLANNED&quot;,&#10;                quantity = null,&#10;                unit = null,&#10;                note = null&#10;            )&#10;        )&#10;        assertTrue(logId &gt; 0)&#10;&#10;        val takenAt = plannedAt + 120_000&#10;        logDao.markTaken(logId, status = &quot;TAKEN&quot;, takenAt = takenAt, quantity = 1.0, unit = &quot;tablet&quot;)&#10;&#10;        val fetched = logDao.getById(logId)&#10;        assertNotNull(fetched)&#10;        assertEquals(&quot;TAKEN&quot;, fetched!!.status)&#10;        assertEquals(takenAt, fetched.takenTime)&#10;        assertEquals(1.0, fetched.quantity!!, 1e-4)&#10;        assertEquals(&quot;tablet&quot;, fetched.unit)&#10;    }&#10;&#10;    @Test&#10;    fun prnSchedule_doesNotCreateTimes() = runBlocking {&#10;        val drugDao = db.drugDao()&#10;        val schedDao = db.doseScheduleDao()&#10;&#10;        val now = System.currentTimeMillis()&#10;&#10;        val drugId = drugDao.insert(&#10;            Drug(uid = &quot;local2&quot;, name = &quot;PRNTest&quot;, brandName = &quot;PRN&quot;, drugbankId = &quot;&quot;, strength = 0.0, unit = &quot;mg&quot;, form = &quot;tablet&quot;, notes = null, createdAt = now, updatedAt = now)&#10;        )&#10;&#10;        // Save a PRN schedule but provide times - sanitizer should remove times&#10;        val schedule = DoseSchedule(&#10;            drugId = drugId,&#10;            prn = true,&#10;            freqType = &quot;PRN&quot;,&#10;            byWeekDay = null,&#10;            intervalHours = null,&#10;            everyNDays = null,&#10;            timesOfDay = listOf(&quot;08:00&quot;, &quot;20:00&quot;),&#10;            timeZone = &quot;UTC&quot;,&#10;            createdAt = now,&#10;            updatedAt = now&#10;        )&#10;&#10;        val timesPairs = listOf(8 * 60 to 1.0, 20 * 60 to 1.0)&#10;        val schedId = schedDao.saveOrReplaceForDrug(schedule, timesPairs)&#10;        assertTrue(schedId &gt; 0)&#10;&#10;        val agg = schedDao.getWithTimesByDrugId(drugId)&#10;        assertNotNull(agg)&#10;        // For PRN schedule the times list should be empty&#10;        assertEquals(0, agg!!.times.size)&#10;        assertTrue(agg.schedule.prn)&#10;    }&#10;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/medtracker/data/db/entities/DoseSchedule.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/medtracker/data/db/entities/DoseSchedule.kt" />
              <option name="originalContent" value="package com.example.medtracker.data.db.entities&#10;&#10;import androidx.room.*&#10;import java.util.TimeZone&#10;&#10;@Entity(&#10;    tableName = &quot;dose_schedule&quot;,&#10;    indices = [Index(value = [&quot;drugId&quot;], unique = true)],&#10;    foreignKeys = [&#10;        ForeignKey(&#10;            entity = Drug::class,&#10;            parentColumns = [&quot;drugId&quot;],&#10;            childColumns = [&quot;drugId&quot;],&#10;            onDelete = ForeignKey.CASCADE&#10;        )&#10;    ]&#10;)&#10;data class DoseSchedule(&#10;    @PrimaryKey(autoGenerate = true)&#10;    val doseScheduleId: Long = 0L,&#10;&#10;    // link to the Drug this schedule belongs to&#10;    @ColumnInfo(name = &quot;drugId&quot;)&#10;    val drugId: Long,&#10;&#10;    val prn: Boolean = false, // as needed (does not require scheduled time)&#10;    val doseAmount: Double? = null,&#10;    val doseUnit: String? = null,  // &quot;mg&quot;, &quot;ml&quot;&#10;&#10;    @ColumnInfo(name = &quot;freq_type&quot;)&#10;    val freqType: String,&#10;&#10;    @ColumnInfo(name = &quot;interval_hours&quot;)&#10;    val intervalHours: Int? = null, // when freqType == &quot;EVERY_N_HOURS&quot; 6, 12&#10;&#10;    @ColumnInfo(name = &quot;every_n_days&quot;)&#10;    val everyNDays: Int? = null,&#10;&#10;    // Use list of weekdays (e.g. [&quot;MON&quot;,&quot;TUE&quot;]) for weekly schedules&#10;    val byWeekDay: List&lt;String&gt;? = null,&#10;&#10;    // Times of day stored as 12-hour lowercase strings (h:mma) via TypeConverter&#10;    // Example: [&quot;12:00am&quot;, &quot;8:30pm&quot;]. `DoseTime` table stores numeric minutes since midnight.&#10;    // (Input may be accepted in 24h or 12h formats; values are normalized before saving.)&#10;    &#10;    val timesOfDay: List&lt;String&gt;? = null,&#10;&#10;    // TimeStamps&#10;    @ColumnInfo(name = &quot;start_date&quot;)&#10;    val startDate: Long? =  null,&#10;    @ColumnInfo(name = &quot;end_date&quot;)&#10;    val endDate: Long? = null,&#10;&#10;    // default to device timezone&#10;    val timeZone: String = TimeZone.getDefault().id,&#10;&#10;    // TimeStamps&#10;    val createdAt: Long = System.currentTimeMillis(),&#10;    val updatedAt: Long = System.currentTimeMillis()&#10;)&#10;" />
              <option name="updatedContent" value="package com.example.medtracker.data.db.entities&#10;&#10;import androidx.room.*&#10;import java.util.TimeZone&#10;&#10;@Entity(&#10;    tableName = &quot;dose_schedule&quot;,&#10;    indices = [Index(value = [&quot;drugId&quot;], unique = true)],&#10;    foreignKeys = [&#10;        ForeignKey(&#10;            entity = Drug::class,&#10;            parentColumns = [&quot;drugId&quot;],&#10;            childColumns = [&quot;drugId&quot;],&#10;            onDelete = ForeignKey.CASCADE&#10;        )&#10;    ]&#10;)&#10;data class DoseSchedule(&#10;    @PrimaryKey(autoGenerate = true)&#10;    val doseScheduleId: Long = 0L,&#10;&#10;    // link to the Drug this schedule belongs to&#10;    @ColumnInfo(name = &quot;drugId&quot;)&#10;    val drugId: Long,&#10;&#10;    val prn: Boolean = false, // as needed (does not require scheduled time)&#10;    val doseAmount: Double? = null,&#10;    val doseUnit: String? = null,  // &quot;mg&quot;, &quot;ml&quot;&#10;&#10;    @ColumnInfo(name = &quot;freq_type&quot;)&#10;    val freqType: String,&#10;&#10;    @ColumnInfo(name = &quot;interval_hours&quot;)&#10;    val intervalHours: Int? = null, // when freqType == &quot;EVERY_N_HOURS&quot; 6, 12&#10;&#10;    @ColumnInfo(name = &quot;every_n_days&quot;)&#10;    val everyNDays: Int? = null,&#10;&#10;    // Use list of weekdays (e.g. [&quot;MON&quot;,&quot;TUE&quot;]) for weekly schedules&#10;    val byWeekDay: List&lt;String&gt;? = null,&#10;&#10;    // Times of day stored as 12-hour lowercase strings (h:mma) via TypeConverter&#10;    // Example: [&quot;12:00am&quot;, &quot;8:30pm&quot;]. `DoseTime` table stores numeric minutes since midnight.&#10;    // (Input may be accepted in 24h or 12h formats; values are normalized before saving.)&#10;    &#10;    val timesOfDay: List&lt;String&gt;? = null,&#10;&#10;    // TimeStamps&#10;    @ColumnInfo(name = &quot;start_date&quot;)&#10;    val startDate: Long? =  null,&#10;    @ColumnInfo(name = &quot;end_date&quot;)&#10;    val endDate: Long? = null,&#10;&#10;    // default to device timezone&#10;    val timeZone: String = TimeZone.getDefault().id,&#10;&#10;    // TimeStamps&#10;    val createdAt: Long = System.currentTimeMillis(),&#10;    val updatedAt: Long = System.currentTimeMillis()&#10;)" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/medtracker/ui/LoginActivity.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/medtracker/ui/LoginActivity.kt" />
              <option name="originalContent" value="package com.example.medtracker.ui&#10;&#10;import android.os.Bundle&#10;import android.widget.Button&#10;import android.widget.EditText&#10;import com.example.medtracker.R&#10;import androidx.appcompat.app.AppCompatActivity&#10;import androidx.lifecycle.lifecycleScope&#10;import com.example.medtracker.data.db.DbBuilder&#10;import com.example.medtracker.data.db.entities.UserProfile&#10;import kotlinx.coroutines.launch&#10;import android.widget.Toast&#10;import java.util.UUID&#10;import android.content.Intent&#10;import android.content.pm.ApplicationInfo&#10;import com.example.medtracker.data.session.SessionManager&#10;&#10;class LoginActivity : AppCompatActivity() {&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        super.onCreate(savedInstanceState)&#10;        setContentView(R.layout.login_activity)&#10;&#10;        val etFirstName = findViewById&lt;EditText&gt;(R.id.etFirstName)&#10;        val etLastName = findViewById&lt;EditText&gt;(R.id.etLastName)&#10;        val etDob = findViewById&lt;EditText&gt;(R.id.etDob)&#10;        val btnLogin = findViewById&lt;Button&gt;(R.id.btnLogin)&#10;&#10;        val db = DbBuilder.getDatabase(applicationContext)&#10;        val userProfileDao = db.userProfileDao()&#10;&#10;        btnLogin.setOnClickListener {&#10;            val firstNameRaw = etFirstName.text.toString()&#10;            val lastNameRaw = etLastName.text.toString()&#10;            val dobRaw = etDob.text.toString()&#10;&#10;            val firstName = normalizeName(firstNameRaw)&#10;            val lastName = normalizeName(lastNameRaw)&#10;&#10;            if (firstName.isEmpty() || lastName.isEmpty() || dobRaw.isBlank()) {&#10;                Toast.makeText(this, &quot;All fields are required&quot;, Toast.LENGTH_SHORT).show()&#10;                return@setOnClickListener&#10;            }&#10;&#10;            val dob = normalizeDob(dobRaw.trim())&#10;            if (dob == null) {&#10;                Toast.makeText(this, &quot;Invalid date format. Use DD/MM/YYYY.&quot;, Toast.LENGTH_LONG).show()&#10;                return@setOnClickListener&#10;            }&#10;&#10;            btnLogin.isEnabled = false&#10;            lifecycleScope.launch {&#10;                try {&#10;                    // Exact match: name + normalized DOB =&gt; login existing&#10;                    val exact = userProfileDao.findByNameAndDob(firstName, lastName, dob)&#10;                    if (exact != null) {&#10;                        userProfileDao.touchSignAt(exact.uid, System.currentTimeMillis())&#10;                        // Persist current uid&#10;                        SessionManager.setCurrentUid(applicationContext, exact.uid)&#10;                        runOnUiThread {&#10;                            navigateToMain(uid = exact.uid, firstName = exact.firstName ?: firstName)&#10;                        }&#10;                        return@launch&#10;                    }&#10;&#10;                    // Single-user rule: if any user already exists and this is not an exact match, block login&#10;                    val any = userProfileDao.getAny()&#10;                    if (any != null) {&#10;                        runOnUiThread {&#10;                            Toast.makeText(&#10;                                this@LoginActivity,&#10;                                &quot;The user for this app is already created OR check given info.&quot;,&#10;                                Toast.LENGTH_LONG&#10;                            ).show()&#10;                        }&#10;                        return@launch&#10;                    }&#10;&#10;                    // No users exist yet  create new and login&#10;                    val uid = UUID.randomUUID().toString()&#10;                    val now = System.currentTimeMillis()&#10;                    val newProfile = UserProfile(&#10;                        uid = uid,&#10;                        firstName = firstName,&#10;                        lastName = lastName,&#10;                        dob = dob,&#10;                        createdAt = now,&#10;                        lastSignAt = now&#10;                    )&#10;                    userProfileDao.upsert(newProfile)&#10;                    // Persist current uid&#10;                    SessionManager.setCurrentUid(applicationContext, uid)&#10;                    runOnUiThread {&#10;                        Toast.makeText(this@LoginActivity, &quot;User created&quot;, Toast.LENGTH_SHORT).show()&#10;                        navigateToMain(uid = uid, firstName = firstName)&#10;                    }&#10;                } catch (e: Exception) {&#10;                    runOnUiThread {&#10;                        Toast.makeText(this@LoginActivity, &quot;Error: ${e.localizedMessage}&quot;, Toast.LENGTH_LONG).show()&#10;                    }&#10;                } finally {&#10;                    runOnUiThread { btnLogin.isEnabled = true }&#10;                }&#10;            }&#10;        }&#10;&#10;    }&#10;&#10;    private fun normalizeName(s: String): String = s.trim().replace(Regex(&quot;\\s+&quot;), &quot; &quot;)&#10;&#10;    // Accepts d/M/yyyy, dd/MM/yyyy and separators '/', '-', '.' and normalizes to dd/MM/yyyy&#10;    private fun normalizeDob(input: String): String? {&#10;        val m = Regex(&quot;&quot;&quot;^\s*(\d{1,2})[./-](\d{1,2})[./-](\d{4})\s*$&quot;&quot;&quot;).find(input)&#10;            ?: return null&#10;        val day = m.groupValues[1].toInt()&#10;        val month = m.groupValues[2].toInt()&#10;        val year = m.groupValues[3].toInt()&#10;        if (day !in 1..31 || month !in 1..12 || year !in 1900..2100) return null&#10;        val dd = day.toString().padStart(2, '0')&#10;        val mm = month.toString().padStart(2, '0')&#10;        return &quot;$dd/$mm/$year&quot;&#10;    }&#10;&#10;    private fun navigateToMain(uid: String, firstName: String) {&#10;        val intent = Intent(this@LoginActivity, MainActivity::class.java)&#10;        intent.putExtra(&quot;uid&quot;, uid)&#10;        intent.putExtra(&quot;firstName&quot;, firstName)&#10;        startActivity(intent)&#10;        finish()&#10;    }&#10;&#10;}" />
              <option name="updatedContent" value="package com.example.medtracker.ui&#10;&#10;import android.os.Bundle&#10;import android.widget.Button&#10;import android.widget.EditText&#10;import com.example.medtracker.R&#10;import androidx.appcompat.app.AppCompatActivity&#10;import androidx.lifecycle.lifecycleScope&#10;import com.example.medtracker.data.db.DbBuilder&#10;import com.example.medtracker.data.db.entities.UserProfile&#10;import kotlinx.coroutines.launch&#10;import android.widget.Toast&#10;import java.util.UUID&#10;import android.content.Intent&#10;import android.content.pm.ApplicationInfo&#10;import com.example.medtracker.data.session.SessionManager&#10;&#10;class LoginActivity : AppCompatActivity() {&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        super.onCreate(savedInstanceState)&#10;        setContentView(R.layout.login_activity)&#10;&#10;        val etFirstName = findViewById&lt;EditText&gt;(R.id.etFirstName)&#10;        val etLastName = findViewById&lt;EditText&gt;(R.id.etLastName)&#10;        val etDob = findViewById&lt;EditText&gt;(R.id.etDob)&#10;        val btnLogin = findViewById&lt;Button&gt;(R.id.btnLogin)&#10;&#10;        val db = DbBuilder.getDatabase(applicationContext)&#10;        val userProfileDao = db.userProfileDao()&#10;&#10;        btnLogin.setOnClickListener {&#10;            val firstNameRaw = etFirstName.text.toString()&#10;            val lastNameRaw = etLastName.text.toString()&#10;            val dobRaw = etDob.text.toString()&#10;&#10;            val firstName = normalizeName(firstNameRaw)&#10;            val lastName = normalizeName(lastNameRaw)&#10;&#10;            if (firstName.isEmpty() || lastName.isEmpty() || dobRaw.isBlank()) {&#10;                Toast.makeText(this, &quot;All fields are required&quot;, Toast.LENGTH_SHORT).show()&#10;                return@setOnClickListener&#10;            }&#10;&#10;            val dob = normalizeDob(dobRaw.trim())&#10;            if (dob == null) {&#10;                Toast.makeText(this, &quot;Invalid date format. Use DD/MM/YYYY.&quot;, Toast.LENGTH_LONG).show()&#10;                return@setOnClickListener&#10;            }&#10;&#10;            btnLogin.isEnabled = false&#10;            lifecycleScope.launch {&#10;                try {&#10;                    // Exact match: name + normalized DOB =&gt; login existing&#10;                    val exact = userProfileDao.findByNameAndDob(firstName, lastName, dob)&#10;                    if (exact != null) {&#10;                        userProfileDao.touchSignAt(exact.uid, System.currentTimeMillis())&#10;                        // Persist current uid&#10;                        SessionManager.setCurrentUid(applicationContext, exact.uid)&#10;                        runOnUiThread {&#10;                            navigateToMain(uid = exact.uid, firstName = exact.firstName ?: firstName)&#10;                        }&#10;                        return@launch&#10;                    }&#10;&#10;                    // Single-user rule: if any user already exists and this is not an exact match, block login&#10;                    val any = userProfileDao.getAny()&#10;                    if (any != null) {&#10;                        runOnUiThread {&#10;                            Toast.makeText(&#10;                                this@LoginActivity,&#10;                                &quot;The user for this app is already created OR check given info.&quot;,&#10;                                Toast.LENGTH_LONG&#10;                            ).show()&#10;                        }&#10;                        return@launch&#10;                    }&#10;&#10;                    // No users exist yet  create new and login&#10;                    val uid = UUID.randomUUID().toString()&#10;                    val now = System.currentTimeMillis()&#10;                    val newProfile = UserProfile(&#10;                        uid = uid,&#10;                        firstName = firstName,&#10;                        lastName = lastName,&#10;                        dob = dob,&#10;                        createdAt = now,&#10;                        lastSignAt = now&#10;                    )&#10;                    userProfileDao.upsert(newProfile)&#10;                    // Persist current uid&#10;                    SessionManager.setCurrentUid(applicationContext, uid)&#10;                    runOnUiThread {&#10;                        Toast.makeText(this@LoginActivity, &quot;User created&quot;, Toast.LENGTH_SHORT).show()&#10;                        navigateToMain(uid = uid, firstName = firstName)&#10;                    }&#10;                } catch (e: Exception) {&#10;                    runOnUiThread {&#10;                        Toast.makeText(this@LoginActivity, &quot;Error: ${e.localizedMessage}&quot;, Toast.LENGTH_LONG).show()&#10;                    }&#10;                } finally {&#10;                    runOnUiThread { btnLogin.isEnabled = true }&#10;                }&#10;            }&#10;        }&#10;&#10;    }&#10;&#10;    private fun normalizeName(s: String): String = s.trim().replace(Regex(&quot;\\s+&quot;), &quot; &quot;)&#10;&#10;    // Accepts d/M/yyyy, dd/MM/yyyy and separators '/', '-', '.' and normalizes to dd/MM/yyyy&#10;    private fun normalizeDob(input: String): String? {&#10;        val m = Regex(&quot;&quot;&quot;^\s*(\d{1,2})[./-](\d{1,2})[./-](\d{4})\s*$&quot;&quot;&quot;).find(input)&#10;            ?: return null&#10;        val day = m.groupValues[1].toInt()&#10;        val month = m.groupValues[2].toInt()&#10;        val year = m.groupValues[3].toInt()&#10;        if (day !in 1..31 || month !in 1..12 || year !in 1900..2100) return null&#10;        val dd = day.toString().padStart(2, '0')&#10;        val mm = month.toString().padStart(2, '0')&#10;        return &quot;$dd/$mm/$year&quot;&#10;    }&#10;&#10;    private fun navigateToMain(uid: String, firstName: String) {&#10;        val intent = Intent(this@LoginActivity, MainActivity::class.java)&#10;        intent.putExtra(&quot;uid&quot;, uid)&#10;        intent.putExtra(&quot;firstName&quot;, firstName)&#10;        startActivity(intent)&#10;        finish()&#10;    }&#10;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/ic_empty.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/ic_empty.xml" />
              <option name="originalContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;vector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:width=&quot;24dp&quot;&#10;    android:height=&quot;24dp&quot;&#10;    android:viewportWidth=&quot;24&quot;&#10;    android:viewportHeight=&quot;24&quot;&gt;&#10;    &lt;!-- Transparent placeholder vector to satisfy references in layout --&gt;&#10;    &lt;path&#10;        android:fillColor=&quot;#00000000&quot;&#10;        android:pathData=&quot;M0,0h24v24H0z&quot;/&gt;&#10;&lt;/vector&gt;&#10;" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;vector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:width=&quot;24dp&quot;&#10;    android:height=&quot;24dp&quot;&#10;    android:viewportWidth=&quot;24&quot;&#10;    android:viewportHeight=&quot;24&quot;&gt;&#10;    &lt;!-- Transparent placeholder vector to satisfy references in layout --&gt;&#10;    &lt;path&#10;        android:fillColor=&quot;#00000000&quot;&#10;        android:pathData=&quot;M0,0h24v24H0z&quot;/&gt;&#10;&lt;/vector&gt;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/values/dimens.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/values/dimens.xml" />
              <option name="originalContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;resources&gt;&#10;    &lt;dimen name=&quot;med_sheet_peek&quot;&gt;280dp&lt;/dimen&gt;&#10;&lt;/resources&gt;&#10;" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;resources&gt;&#10;    &lt;dimen name=&quot;med_sheet_peek&quot;&gt;280dp&lt;/dimen&gt;&#10;&lt;/resources&gt;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/values/themes.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/values/themes.xml" />
              <option name="originalContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;resources&gt;&#10;&#10;    &lt;style name=&quot;Theme.MedTracker&quot; parent=&quot;Theme.MaterialComponents.DayNight.NoActionBar&quot; /&gt;&#10;&lt;/resources&gt;" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;resources&gt;&#10;&#10;    &lt;style name=&quot;Theme.MedTracker&quot; parent=&quot;Theme.MaterialComponents.DayNight.NoActionBar&quot; /&gt;&#10;&lt;/resources&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>